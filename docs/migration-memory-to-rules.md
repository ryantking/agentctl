# Migration Guide: Memory Commands to Rules System

This guide helps you migrate from the deprecated `agentctl memory` commands to the new `agentctl rules` system.

## Overview

The `agentctl memory` commands are deprecated in favor of the new modular rules system. The rules system provides:

- **Modularity**: Rules can be added/removed independently
- **Reusability**: Rules can be shared across projects
- **Tool-specific**: Rules can target specific tools (Claude, Cursor, Windsurf)
- **Versioning**: Rules can evolve independently
- **Better organization**: Rules stored in `.agent/rules/` instead of monolithic files

## Migration Steps

### 1. Initialize Rules System

```bash
# Initialize .agent directory with default rules
agentctl rules init
```

This creates:
- `.agent/rules/` with default rules extracted from AGENTS.md
- `.agent/research/` directory
- `.agent/project.md` (generated from repository)

### 2. Review Default Rules

```bash
# List all available rules
agentctl rules list

# Show a specific rule
agentctl rules show git-workflow
```

Default rules include:
- `git-workflow.mdc` - Conventional commits and PR workflows
- `tool-selection.mdc` - When to use specialized tools vs bash
- `workspace-management.mdc` - agentctl workspace commands
- `global-hooks.mdc` - Context injection and auto-commit
- `beads-workflow.mdc` - Issue tracking with bd (beads)

### 3. Sync Rules to Generate AGENTS.md/CLAUDE.md

```bash
# Generate AGENTS.md and CLAUDE.md from rules
agentctl rules sync --agents --claude-md
```

This generates:
- `AGENTS.md` - Table of contents listing all rules
- `CLAUDE.md` - Simple overview with project.md and skills list

### 4. Customize Rules (Optional)

```bash
# Add custom rules
agentctl rules add "Always use TypeScript strict mode" --name typescript-strict

# Edit existing rules
vim .agent/rules/git-workflow.mdc

# Remove rules you don't need
agentctl rules remove workspace-management
```

### 5. Sync to Tool-Specific Formats

```bash
# Sync to Cursor
agentctl rules sync --cursor

# Sync to Claude skills
agentctl rules sync --claude

# Or sync everything at once
agentctl rules sync
```

### 6. Remove Old Files (Optional)

Once you've verified the new system works:

```bash
# Remove old AGENTS.md/CLAUDE.md if you prefer rules-only approach
# (They'll be regenerated by 'rules sync' anyway)
rm AGENTS.md CLAUDE.md
```

## Command Mapping

| Old Command | New Command | Notes |
|-------------|-------------|-------|
| `agentctl memory init` | `agentctl rules init` | Creates `.agent/` directory instead of AGENTS.md/CLAUDE.md |
| `agentctl memory show` | `agentctl rules show` | Shows individual rules instead of memory files |
| `agentctl memory validate` | N/A | Validation happens automatically during sync |
| `agentctl memory index` | `agentctl rules init` | project.md generation included in init |

## Key Differences

### File Structure

**Old (Memory):**
```
AGENTS.md          # Monolithic file with all instructions
CLAUDE.md          # Claude-specific additions
```

**New (Rules):**
```
.agent/
├── rules/         # Modular rule files
│   ├── git-workflow.mdc
│   ├── tool-selection.mdc
│   └── ...
├── research/      # Research artifacts
└── project.md     # Repository overview

AGENTS.md          # Generated TOC (optional)
CLAUDE.md          # Generated overview (optional)
.cursor/rules/     # Synced for Cursor (optional)
.claude/skills/    # Synced for Claude (optional)
```

### Workflow

**Old:**
1. Edit AGENTS.md/CLAUDE.md directly
2. Run `agentctl memory validate` to check
3. Run `agentctl memory index` to update repository context

**New:**
1. Edit rules in `.agent/rules/*.mdc`
2. Run `agentctl rules sync` to update all formats
3. Rules automatically sync to Cursor, Claude skills, AGENTS.md, CLAUDE.md

## Benefits of Migration

1. **Modularity**: Add/remove rules independently without editing large files
2. **Reusability**: Share rules across projects
3. **Tool-specific**: Rules can target specific tools
4. **Better organization**: Rules grouped by topic
5. **Automatic sync**: One command updates all formats
6. **Versioning**: Track rule evolution independently

## Backward Compatibility

The old `agentctl memory` commands still work but show deprecation warnings. They will be removed in a future version. We recommend migrating to the rules system as soon as possible.

## Getting Help

- See `agentctl rules --help` for command reference
- See [docs/rules.md](rules.md) for complete documentation
- Check `.agent/rules/` for example rule files
